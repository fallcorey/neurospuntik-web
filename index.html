<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroSputnik üß† - AI –°–ø—É—Ç–Ω–∏–∫</title>
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI —Å–ø—É—Ç–Ω–∏–∫ —Å –æ–±—É—á–µ–Ω–∏–µ–º">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icons/icon-192.png">
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            padding: 10px;
            gap: 5px;
        }

        .nav-tab {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤–∫–ª–∞–¥–æ–∫ */
        .tab-content {
            flex: 1;
            overflow: hidden;
            display: none;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        /* –ß–∞—Ç */
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease;
        }

        .user-message {
            align-self: flex-end;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border-bottom-right-radius: 5px;
        }

        .neuro-message {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.15);
            border-bottom-left-radius: 5px;
        }

        .input-area {
            padding: 15px;
            background: rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #messageInput {
            flex: 1;
            padding: 12px 18px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            color: white;
            font-size: 16px;
        }

        #messageInput::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .send-btn {
            padding: 12px;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –û–±—É—á–µ–Ω–∏–µ */
        .training-section {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        .file-upload {
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
        }

        .knowledge-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .knowledge-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-section {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        .setting-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            z-index: 1000;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="chat">üí¨ –ß–∞—Ç</button>
            <button class="nav-tab" data-tab="training">üìö –û–±—É—á–µ–Ω–∏–µ</button>
            <button class="nav-tab" data-tab="memory">üß† –ü–∞–º—è—Ç—å</button>
            <button class="nav-tab" data-tab="settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ß–∞—Ç -->
        <div class="tab-content active" id="chat">
            <div class="chat-messages" id="chatMessages">
                <div class="message neuro-message">
                    <strong>NeuroSputnik:</strong> –ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π AI-—Å–ø—É—Ç–Ω–∏–∫. –û–±—É—á–∏ –º–µ–Ω—è —Å–≤–æ–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏ –¥–ª—è –ª—É—á—à–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤! üöÄ
                </div>
            </div>
            <div class="input-area">
                <input type="text" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                <button class="send-btn" id="sendBtn">‚Üë</button>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –û–±—É—á–µ–Ω–∏–µ -->
        <div class="tab-content" id="training">
            <div class="training-section">
                <div class="file-upload" id="fileUpload">
                    <h3>üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∑–Ω–∞–Ω–∏—è</h3>
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Ñ–∞–π–ª—ã –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                    <input type="file" id="fileInput" multiple accept=".txt,.pdf,.docx" style="display: none;">
                    <button onclick="document.getElementById('fileInput').click()" style="margin-top: 10px; padding: 10px 20px; background: rgba(255,255,255,0.2); border: none; border-radius: 10px; color: white;">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
                </div>
                <div class="knowledge-list" id="knowledgeList">
                    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∑–Ω–∞–Ω–∏–π -->
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ü–∞–º—è—Ç—å -->
        <div class="tab-content" id="memory">
            <div class="training-section">
                <h3>üéØ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–º—è—Ç–∏</h3>
                <div class="setting-item">
                    <div>–ò–∑—É—á–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: <span id="docCount">0</span></div>
                    <div>–°–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–∞–º—è—Ç–∏: <span id="msgCount">1</span></div>
                    <div>–†–∞–∑–º–µ—Ä –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π: <span id="dbSize">0 KB</span></div>
                </div>
                
                <h3 style="margin-top: 20px;">üìä –¢–µ–º—ã –æ–±—É—á–µ–Ω–∏—è</h3>
                <div id="topicsList">
                    <!-- –°–ø–∏—Å–æ–∫ –∏–∑—É—á–µ–Ω–Ω—ã—Ö —Ç–µ–º -->
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="tab-content" id="settings">
            <div class="settings-section">
                <div class="setting-item">
                    <h3>üîß –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</h3>
                    <select id="aiMode" style="width: 100%; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                        <option value="fast">–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º</option>
                        <option value="quality">–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º</option>
                        <option value="creative">–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º</option>
                    </select>
                </div>
                
                <div class="setting-item">
                    <h3>üíæ –•—Ä–∞–Ω–∏–ª–∏—â–µ</h3>
                    <button onclick="clearData()" style="width: 100%; padding: 12px; background: rgba(255,100,100,0.3); border: none; border-radius: 10px; color: white; margin-bottom: 10px;">–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                    <button onclick="exportData()" style="width: 100%; padding: 12px; background: rgba(100,255,100,0.3); border: none; border-radius: 10px; color: white;">–≠–∫—Å–ø–æ—Ä—Ç –∑–Ω–∞–Ω–∏–π</button>
                </div>
                
                <div class="setting-item">
                    <h3>üì≤ –£—Å—Ç–∞–Ω–æ–≤–∫–∞</h3>
                    <button onclick="installApp()" id="installBtn" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.2); border: none; border-radius: 10px; color: white;">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ë–ê–ó–ê –î–ê–ù–ù–´–• ====================
        class NeuroDatabase {
            constructor() {
                this.dbName = 'NeuroSputnikDB';
                this.version = 1;
                this.init();
            }

            async init() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.version);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // –¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
                        if (!db.objectStoreNames.contains('messages')) {
                            const messagesStore = db.createObjectStore('messages', { keyPath: 'id', autoIncrement: true });
                            messagesStore.createIndex('timestamp', 'timestamp', { unique: false });
                        }
                        
                        // –¢–∞–±–ª–∏—Ü–∞ –∑–Ω–∞–Ω–∏–π
                        if (!db.objectStoreNames.contains('knowledge')) {
                            const knowledgeStore = db.createObjectStore('knowledge', { keyPath: 'id', autoIncrement: true });
                            knowledgeStore.createIndex('type', 'type', { unique: false });
                        }
                        
                        // –¢–∞–±–ª–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
                        if (!db.objectStoreNames.contains('settings')) {
                            db.createObjectStore('settings', { keyPath: 'key' });
                        }
                    };
                });
            }

            async addMessage(message) {
                const transaction = this.db.transaction(['messages'], 'readwrite');
                const store = transaction.objectStore('messages');
                return store.add({
                    ...message,
                    timestamp: Date.now()
                });
            }

            async getMessages(limit = 50) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['messages'], 'readonly');
                    const store = transaction.objectStore('messages');
                    const index = store.index('timestamp');
                    const request = index.openCursor(null, 'prev');
                    const messages = [];
                    
                    request.onsuccess = (event) => {
                        const cursor = event.target.result;
                        if (cursor && messages.length < limit) {
                            messages.push(cursor.value);
                            cursor.continue();
                        } else {
                            resolve(messages.reverse());
                        }
                    };
                    
                    request.onerror = () => reject(request.error);
                });
            }

            async addKnowledge(knowledge) {
                const transaction = this.db.transaction(['knowledge'], 'readwrite');
                const store = transaction.objectStore('knowledge');
                return store.add({
                    ...knowledge,
                    created: Date.now()
                });
            }

            async getKnowledge() {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['knowledge'], 'readonly');
                    const store = transaction.objectStore('knowledge');
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
        }

        // ==================== –û–°–ù–û–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï ====================
        class NeuroSputnikApp {
            constructor() {
                this.db = new NeuroDatabase();
                this.currentTab = 'chat';
                this.knowledgeBase = [];
                this.init();
            }

            async init() {
                await this.db.init();
                this.loadMessages();
                this.loadKnowledge();
                this.bindEvents();
                this.registerSW();
            }

            bindEvents() {
                // –ù–∞–≤–∏–≥–∞—Ü–∏—è
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.tab);
                    });
                });

                // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
                document.getElementById('sendBtn').addEventListener('click', () => {
                    this.sendMessage();
                });

                document.getElementById('messageInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendMessage();
                    }
                });

                // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
                document.getElementById('fileInput').addEventListener('change', (e) => {
                    this.handleFiles(e.target.files);
                });

                // Drag and drop
                const fileUpload = document.getElementById('fileUpload');
                fileUpload.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    fileUpload.style.background = 'rgba(255,255,255,0.2)';
                });

                fileUpload.addEventListener('dragleave', () => {
                    fileUpload.style.background = '';
                });

                fileUpload.addEventListener('drop', (e) => {
                    e.preventDefault();
                    fileUpload.style.background = '';
                    this.handleFiles(e.dataTransfer.files);
                });
            }

            switchTab(tabName) {
                this.currentTab = tabName;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.tab === tabName);
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.toggle('active', content.id === tabName);
                });
            }

            async sendMessage() {
                const input = document.getElementById('messageInput');
                const message = input.value.trim();
                
                if (!message) return;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await this.addMessage(message, 'user');
                input.value = '';
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
                setTimeout(() => {
                    this.generateAIResponse(message);
                }, 500);
            }

            async addMessage(text, type) {
                const message = {
                    text,
                    type,
                    timestamp: Date.now()
                };
                
                await this.db.addMessage(message);
                this.displayMessage(message);
            }

            displayMessage(message) {
                const messagesDiv = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${message.type}-message`;
                messageDiv.innerHTML = `<strong>${message.type === 'user' ? '–í—ã' : 'NeuroSputnik'}:</strong> ${message.text}`;
                messagesDiv.appendChild(messageDiv);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }

            async loadMessages() {
                const messages = await this.db.getMessages();
                messages.forEach(msg => this.displayMessage(msg));
            }

            generateAIResponse(userMessage) {
                // –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞–Ω–∏–π
                const response = this.generateIntelligentResponse(userMessage);
                this.addMessage(response, 'neuro');
                this.updateStats();
            }

            generateIntelligentResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
                const knowledgeMatch = this.findInKnowledge(lowerMessage);
                if (knowledgeMatch) {
                    return `–ù–∞ –æ—Å–Ω–æ–≤–µ –∏–∑—É—á–µ–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤: ${knowledgeMatch}`;
                }
                
                // –ë–∞–∑–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã
                if (lowerMessage.includes('–ø—Ä–∏–≤–µ—Ç')) {
                    return '–ü—Ä–∏–≤–µ—Ç! –†–∞–¥ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å? üöÄ';
                }
                
                if (lowerMessage.includes('–∫–∞–∫ –¥–µ–ª–∞')) {
                    return '–í—Å—ë –æ—Ç–ª–∏—á–Ω–æ! –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –∏ –∏–∑—É—á–µ–Ω–∏—é –Ω–æ–≤–æ–≥–æ!';
                }
                
                if (lowerMessage.includes('—Å–ø–∞—Å–∏–±–æ')) {
                    return '–í—Å–µ–≥–¥–∞ —Ä–∞–¥ –ø–æ–º–æ—á—å! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —É—á–∏—Ç—å—Å—è –≤–º–µ—Å—Ç–µ! ‚ú®';
                }
                
                // –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞
                if (this.isTechnicalQuestion(lowerMessage)) {
                    return '–≠—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –µ–≥–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ...';
                }
                
                if (this.isCreativeQuestion(lowerMessage)) {
                    return '–û—Ç–ª–∏—á–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞! –î–∞–≤–∞–π—Ç–µ brainstorm...';
                }
                
                return '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –ú–æ–∂–µ—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.';
            }

            findInKnowledge(message) {
                for (const knowledge of this.knowledgeBase) {
                    if (knowledge.content && message.includes(knowledge.content.toLowerCase().substring(0, 20))) {
                        return knowledge.content.substring(0, 150) + '...';
                    }
                }
                return null;
            }

            isTechnicalQuestion(message) {
                const techKeywords = ['–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å', '–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä', '–∫–æ–¥', '–∞–ª–≥–æ—Ä–∏—Ç–º', '—Ç–µ—Ö–Ω–∏—á–µ—Å–∫'];
                return techKeywords.some(keyword => message.includes(keyword));
            }

            isCreativeQuestion(message) {
                const creativeKeywords = ['–∏–¥–µ—è', '–ø—Ä–∏–¥—É–º–∞–π', '—Å–æ–∑–¥–∞–π', '–∫—Ä–µ–∞—Ç–∏–≤', '–∏–Ω–Ω–æ–≤–∞—Ü'];
                return creativeKeywords.some(keyword => message.includes(keyword));
            }

            async handleFiles(files) {
                for (let file of files) {
                    await this.processFile(file);
                }
                this.showNotification(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${files.length} —Ñ–∞–π–ª–æ–≤`);
            }

            async processFile(file) {
                const content = await this.readFileContent(file);
                
                const knowledge = {
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    content: content.substring(0, 10000), // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä
                    uploaded: Date.now()
                };
                
                await this.db.addKnowledge(knowledge);
                this.knowledgeBase.push(knowledge);
                this.updateKnowledgeList();
            }

            readFileContent(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsText(file);
                });
            }

            async loadKnowledge() {
                this.knowledgeBase = await this.db.getKnowledge();
                this.updateKnowledgeList();
            }

            updateKnowledgeList() {
                const list = document.getElementById('knowledgeList');
                list.innerHTML = this.knowledgeBase.map(knowledge => `
                    <div class="knowledge-item">
                        <div>
                            <strong>${knowledge.name}</strong>
                            <div style="font-size: 0.8em; opacity: 0.8;">${knowledge.size} bytes</div>
                        </div>
                        <button onclick="app.deleteKnowledge(${knowledge.id})" style="background: rgba(255,100,100,0.3); border: none; border-radius: 5px; color: white; padding: 5px 10px;">√ó</button>
                    </div>
                `).join('');
            }

            updateStats() {
                document.getElementById('docCount').textContent = this.knowledgeBase.length;
                document.getElementById('msgCount').textContent = document.querySelectorAll('.message').length;
                document.getElementById('dbSize').textContent = this.calculateDBSize();
            }

            calculateDBSize() {
                const total = this.knowledgeBase.reduce((sum, k) => sum + (k.content?.length || 0), 0);
                return Math.round(total / 1024) + ' KB';
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            async registerSW() {
                if ('serviceWorker' in navigator) {
                    try {
                        await navigator.serviceWorker.register('/sw.js');
                        console.log('SW registered');
                    } catch (error) {
                        console.log('SW registration failed:', error);
                    }
                }
            }
        }

        // ==================== PWA –§–£–ù–ö–¶–ò–ò ====================
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBtn').style.display = 'block';
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted install');
                    }
                    deferredPrompt = null;
                });
            }
        }

        function clearData() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?')) {
                indexedDB.deleteDatabase('NeuroSputnikDB');
                localStorage.clear();
                location.reload();
            }
        }

        function exportData() {
            const data = {
                knowledge: app.knowledgeBase,
                timestamp: Date.now()
            };
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'neurospuntik-backup.json';
            a.click();
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const app = new NeuroSputnikApp();
        window.app = app;
    </script>
</body>
</html>
